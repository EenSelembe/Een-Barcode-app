<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bundle Script — Aman & Rapi</title>
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin:0; }
    header, footer { padding:16px 20px; background:#f5f5f5; border-bottom:1px solid #e5e5e5; }
    @media (prefers-color-scheme: dark){
      header, footer { background:#111; border-color:#222; }
    }
    main { padding:16px 20px; display:grid; gap:14px; }
    .card { border:1px solid #e5e5e5; border-radius:14px; padding:14px; background:#fff; }
    @media (prefers-color-scheme: dark){
      .card { background:#0d0d0d; border-color:#222; }
    }
    .toolbar { display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
    button {
      cursor:pointer; border:1px solid #ccc; background:#fafafa; padding:8px 12px; border-radius:10px;
    }
    button:hover { background:#f0f0f0; }
    pre, code, textarea { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    textarea { width:100%; min-height:220px; padding:10px; border-radius:10px; border:1px solid #ddd; }
    #log { max-height:240px; overflow:auto; background:#0b1020; color:#e5f0ff; padding:10px; border-radius:10px; }
    .ok { color:#3fb950; }
    .warn { color:#d29922; }
    .err { color:#f85149; }
    small.mono { font-family: ui-monospace, monospace; opacity:.9; }
  </style>
</head>
<body>
  <header>
    <strong>Script Anda — versi aman & rapi</strong><br>
    <small class="mono">Tidak ada bagian yang dibuang; saya hanya menambahkan shim agar halaman bisa berjalan.</small>
  </header>

  <main>
    <section class="card">
      <div class="toolbar">
        <button id="btn-run">Jalankan</button>
        <button id="btn-validate">Validasi Cepat</button>
        <button id="btn-copy">Salin HTML Ini</button>
        <span id="status" style="margin-left:auto; font-size:12px; opacity:.8;">Siap.</span>
      </div>
      <textarea id="src" spellcheck="false"></textarea>
    </section>

    <section class="card">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
        <strong>Log Eksekusi</strong>
        <small class="mono" style="opacity:.7;">(Console dialihkan ke panel ini)</small>
      </div>
      <pre id="log"></pre>
    </section>
  </main>

  <footer>
    <small class="mono">Tips: Tempelkan sisa script asli Anda di area yang ditandai “PASTE THE REST…”, lalu klik “Jalankan”.</small>
  </footer>

  <script>
    // --- Console to panel ----------------------------------------------------
    (function hookConsole(){
      const logEl = document.getElementById('log');
      const write = (cls, ...args) => {
        const line = document.createElement('div');
        line.className = cls;
        try { line.textContent = args.map(a => typeof a === 'string' ? a : JSON.stringify(a)).join(' '); }
        catch { line.textContent = args.join(' '); }
        logEl.appendChild(line);
        logEl.scrollTop = logEl.scrollHeight;
      };
      const orig = { log:console.log, warn:console.warn, error:console.error, info:console.info };
      console.log = (...a)=>{ write('ok', ...a); orig.log.apply(console,a); };
      console.warn = (...a)=>{ write('warn', ...a); orig.warn.apply(console,a); };
      console.error = (...a)=>{ write('err', ...a); orig.error.apply(console,a); };
      console.info = (...a)=>{ write('', ...a); orig.info.apply(console,a); };
      window.__restoreConsole = () => Object.assign(console, orig);
    })();

    // --- Shim helper minimal (mencegah ReferenceError) ----------------------
    // Catatan: ini hanya fallback aman. Jika fungsi asli tersedia di bagian lain
    // skrip Anda, definisi asli akan menimpa shim ini.
    (function shims(global){
      const isFn = v => typeof v === 'function';

      function shim(name, impl){
        if (!(name in global) || typeof global[name] !== 'function') {
          Object.defineProperty(global, name, { value: impl, configurable: true, writable: true });
        }
      }

      // Converter util sederhana agar obfuscated-call tidak meledak
      const num = x => (typeof x === 'number' && isFinite(x)) ? x : 0;
      const str = x => (x==null) ? '' : String(x);

      // Fungsi yang sering muncul di fragmen Anda:
      shim('jh', (a,b,c,d,e)=> str(a)+str(b)+str(c)+str(d)+str(e));
      shim('jR', (a,b,c,d,e)=> str(a));
      shim('jG', (a,b,c,d,e)=> num(a)+num(b)+num(c)+num(d)-num(e));
      shim('jy', (a,b,c,d,e)=> str(e||d||c||b||a));
      shim('f',  (x)=> x|0);
      shim('ne', (x)=> x|0);
      shim('se', (a,b,cb)=> { try{ if (typeof cb==='function') cb(null, true);}catch(e){} });
      shim('J',  ()=> false);

      // Beberapa global yang kemungkinan dipakai:
      if (!('gtag' in global)) global.gtag = function(){ /* noop */ };
      if (!('shell' in global)) global.shell = { exec(){}, openExternal(){}, showItemInFolder(){} };
      if (!('Pe' in global)) global.Pe = { track(){}, trigger(){}, push(){}, postMessage(){} };

      // NodeList shortcut
      if (!('qS' in global)) global.qS = (sel,root=document)=>root.querySelector(sel);
      if (!('qSA' in global)) global.qSA = (sel,root=document)=>Array.from(root.querySelectorAll(sel));
    })(window);

    // --- Loader untuk skrip asli Anda ---------------------------------------
    function runOriginal(sourceText){
      const status = document.getElementById('status');
      status.textContent = 'Menjalankan...';
      try {
        // Eksekusi di Function sandbox dengan akses window
        const fn = new Function('window', `
          "use strict";
          try {
            (function(){
              // >>> BEGIN: ORIGINAL SCRIPT FRAGMENT (from your message)
${originalFragment().replace(/<\/script>/gi, '<\\/script>')}
              // <<< END: ORIGINAL SCRIPT FRAGMENT

              // PASTE THE REST OF YOUR ORIGINAL SCRIPT HERE (jika ada)
            })();
          } catch(e){ console.error('Error di blok skrip asli:', e && e.message ? e.message : e); }
        `);
        fn(window);
        status.textContent = 'Selesai.';
        console.log('Eksekusi selesai.');
      } catch (e) {
        status.textContent = 'Gagal.';
        console.error('Gagal eksekusi:', e);
      }
    }

    // --- Fragment asli Anda dimasukkan ke sini (apa adanya) -----------------
    function originalFragment(){
      return String.raw`
function NT(Y4, Y5, Y6, Y7, Y8) {
    return jh(Y4 - 0x19b, Y7, Y6 - 0x1d5, Y7 - 0x171, Y8 - 0x140);
}
function NL(Y4, Y5, Y6, Y7, Y8) {
    return jR(Y5, Y6 - 0x120, Y6 - 0x41, Y4 - 0x1c6, Y8 - 0x1d5);
}
function Nc(Y4, Y5, Y6, Y7, Y8) {
    return jG(Y5 - 0x17b, Y6 - 0x18, Y6 - 0x56, Y7 - 0x142, Y4);
}
function Ne(Y4, Y5, Y6, Y7, Y8) {
    return jh(Y4 - 0x8a, Y5, Y6 - 0x47, Y7 - 0x74, Y6 - 0x25);
}
var Y5 = !![];
return function (Y6, Y7) {
    function NY(Y4, Y5, Y6, Y7, Y8) {
        return NL(Y4 - 0x1b3, Y6, Y6 - 0x38, Y7 - 0x143, Y7 - -0x41a);
    }
    function Nl(Y4, Y5, Y6, Y7, Y8) {
        return NK(Y4 - 0x16d, Y5 - 0x40, Y6, Y7 - 0x43, Y5 - -0x14e);
    }
    function Nr(Y4, Y5, Y6, Y7, Y8) {
        return Nc(Y7, Y5 - -0x1ed, Y6 - 0x141, Y7 - 0x161, Y8 - 0x1a0);
    }
    function Nh(Y4, Y5, Y6, Y7, Y8) {
        return NV(Y4 - 0x152, Y5 - 0x137, Y6 - -0xe6, Y7 - 0x136, Y4);
    }
    function NJ(Y4, Y5, Y6, Y7, Y8) {
        return NL(Y4 - 0x16f, Y8, Y6 - 0x110, Y7 - 0x15, Y5 - -0x348);
    }
    var Y8 = {
        'fEwWc': Y4['mfpjE'],
        'wBeWe': function (Ya, Yb) {
            function Nk(Y4, Y5, Y6, Y7, Y8) {
                return f(Y4 - -0x3d7, Y5);
            }
            return Y4[Nk(-0x1bc, 'jK2*', -0x138, -0x250, 0x2e)](Ya, Yb);
        },
        'RkRnI': Y4[NJ(0x16f8, 0x146b, 0x1486, 0x12f6, 'GG8&')],
        'ltknI': function (Ya, Yb, Yc) {
            function Np(Y4, Y5, Y6, Y7, Y8) {
                return NJ(Y4 - 0x139, Y5 - 0x1c7, Y6 - 0x198, Y7 - 0x153, Y8);
            }
            return Y4[Np(0x1596, 0x179b, 0x13e2, 0x1075, 'u2MR')](Ya, Yb, Yc);
        },
        'ozAXJ': Y4[NY(0xc49, 0x46c, 'u2MR', 0x3d2, 0x3a3)],
        'BTeDV': function (Ya, Yb) {
            function Nq(Y4, Y5, Y6, Y7, Y8) {
                return Nr(Y4 - 0x129, Y5 - 0x88, Y6 - 0x184, Y5, Y8 - 0x13d);
            }
            return Y4[Nq(0xb47, 0x136b, 0x13cf, 'FTOO', 0xe8d)](Ya, Yb);
        },
        'zQdLJ': Y4[Nh('i%HQ', 0x1179, 0x15d6, 0x1e2a, 0x1795)],
        'wsbKK': function (Ya, Yb) {
            function Nw(Y4, Y5, Y6, Y7, Y8) {
                return Nl(Y4 - 0x11e, Y5 - 0x4f0, Y7, Y6 - 0x62, Y8 - 0x7);
            }
            return Y4[Nw(0x1024, 0x153b, 0x1494, 'nN#M', 0x1180)](Ya, Yb);
        },
        'NBtQN': function (Ya) {
            function Nn(Y4, Y5, Y6, Y7, Y8) {
                return NJ(Y4 - 0x90, Y5 - 0xf1, Y6 - 0x12a, Y7 - 0x157, Y8);
            }
            return Y4[Nn(0x17f0, 0x12bb, 0x1a36, 0x1c4c, 'DKdx')](Ya);
        },
        'GeGnE': function (Ya, Yb) {
            function No(Y4, Y5, Y6, Y7, Y8) {
                return Nl(Y4 - 0x15e, Y5 - 0x47, Y8, Y7 - 0xd3, Y6 - -0x6a);
            }
            return Y4[No(0x4c2, 0x12a, 0x461, -0x70, '@7C6')](Ya, Yb);
        },
        'hrFqu': function (Ya, Yb) {
            function Ny(Y4, Y5, Y6, Y7, Y8) {
                return Nl(Y4 - 0x8e, Y5 - 0x83, Y6, Y7 - 0x1f8, Y8 - -0x1dd);
            }
            return Y4[Ny(0xe64, 0x10c6, 'i%HQ', 0x11db, 0x1473)](Ya, Yb);
        },
        'HNaIb': Y4[Nr(0x17ab, 0x19c8, 0x13d6, 'Zq#6', 0x1677)]
    };
};`;
    }

    // --- UI wiring -----------------------------------------------------------
    const srcArea = document.getElementById('src');
    const btnRun = document.getElementById('btn-run');
    const btnValidate = document.getElementById('btn-validate');
    const btnCopy = document.getElementById('btn-copy');

    // Muat fragment ke textarea saat awal
    srcArea.value =
`// Fragmen asli Anda dimuat otomatis di bawah saat eksekusi.
// Jika Anda punya bagian tambahan, tempelkan setelah komentar "PASTE THE REST..."
${originalFragment()}

`;

    btnRun.addEventListener('click', () => {
      const userCode = srcArea.value || originalFragment();
      // Gabungkan shim + user code
      runOriginal(userCode);
    });

    btnValidate.addEventListener('click', () => {
      try {
        new Function(srcArea.value || originalFragment());
        console.log('Validasi sintaks OK.');
      } catch (e) {
        console.warn('Validasi gagal:', e.message || e);
      }
    });

    btnCopy.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(document.documentElement.outerHTML);
        console.log('HTML ini berhasil disalin ke clipboard.');
      } catch (e) {
        console.warn('Gagal menyalin otomatis. Pilih semua lalu salin manual.');
      }
    });
  </script>
</body>
</html>
